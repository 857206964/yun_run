name: Random Cron

on:
  workflow_run:
    workflows: ["åˆ·æ­¥æ•°"]
    types:
      - completed
  workflow_dispatch:

jobs:
  randomize-cron:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    if: github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT }}  # å¿…é¡»ä½¿ç”¨PATæ‰èƒ½è§¦å‘æ–°workflow
          
      - name: éšæœºåŒ–Cronæ—¶é—´
        run: |
          source cron_convert.sh
          echo "ğŸ“… å½“å‰é…ç½®çš„å°æ—¶èŒƒå›´: ${{ vars.CRON_HOURS }}"
          persist_execute_log ${{ github.event_name }} ${{ vars.CRON_HOURS }}
          
      - name: æäº¤æ›´æ”¹
        run: |
          git config user.name github-actions[bot]
          git config user.email github-actions[bot]@users.noreply.github.com
          git add .github/workflows/step.yml
          
          current=`TZ=Asia/Shanghai date '+%Y-%m-%d %H:%M:%S'`
          git diff --staged --quiet || git commit -m "â° [${current}] éšæœºCronæ—¶é—´ (è§¦å‘æ–¹å¼: ${{ github.event_name }})"
          git push origin main || git push origin master
